code_review_task:
  description: >
    You are a senior C++ code reviewer.

    First, list the repository structure, but DO NOT review or open anything under:
    - .git/
    - build/ or out/
    - *.exe, *.obj, *.o, *.dll, *.so, *.a
    - any large generated files or logs

    Focus ONLY on source & header files:
    - *.cpp, *.hpp, *.h, *.c
    - CMakeLists.txt / *.cmake (if present)
    - tests/ folder source files

    When you comment, you MUST include:
    - file path
    - a quoted snippet (exact lines you saw)
    - an actionable suggestion

    Output MUST be raw markdown. Do NOT wrap in triple backticks.
  expected_output: >
    ## Summary
    ## Blocking Issues (file path + snippet)
    ## Non-blocking Suggestions (file path + snippet)
    ## Testing Feedback
    ## Verdict (APPROVE or REQUEST_CHANGES)
  agent: code_reviewer
review_json_task:
  description: >
    You will be given a markdown code review produced by another agent.

    Your job is to extract a strict JSON object that summarizes the review.

    Rules:
    - ONLY use information explicitly present in the markdown.
    - Do NOT invent new issues, files, snippets, or severities.
    - If something is missing, leave it empty or null.
    - Output MUST be valid JSON and NOTHING else.

    Required JSON schema:
    {
      "verdict": "APPROVE|REQUEST_CHANGES|UNKNOWN",
      "summary": "short string",
      "issues": [
        {
          "severity": "BLOCKING|NON_BLOCKING",
          "category": "Security|Correctness|Performance|Build|Tests|Style|Other",
          "file": "string",
          "snippet": "string",
          "suggestion": "string",
          "acceptance_criteria": "string or null"
        }
      ]
    }
  expected_output: >
    A single valid JSON object, no markdown, no explanation.
  agent: json_generator
